BagUtils = {}

function BagUtils.hasItem(id)
  return BagUtils.getQuantity(id) ~= 0
end

function BagUtils.getQuantity(id)
  local pocketId, itemId = BagUtils.getLocation(id)
  if pocketId == nil then return 0 end
  return pb.getBag():getPocket(pocketId):getItem(itemId):getQuantity()
end

function BagUtils.getLocation(id)
  local reqItem = pb.getItem(id)
  local pocket = pb.getBag():getPocket(reqItem:getPocket())

  -- Berry pouch is sorted, so do that
  if reqItem:getPocket() == pocketType.berryPouch then
    local berries = {}
    for itemId = 0, pocket:getCapacity() - 1 do
      local item = pocket:getItem(itemId)
      if item:getId() == 0 then break end
      table.insert(berries, pb.getItem(item:getId()))
    end
    table.sort(berries, function(a, b) return a:getId() < b:getId() end)

    for i = 1, #berries do
      if berries[i]:getId() == id then return reqItem:getPocket(), i - 1 end
    end

  -- Normal lookup for other pockets
  else
    for itemId = 0, pocket:getCapacity() - 1 do
      local item = pocket:getItem(itemId)
      if item:getId() == 0 then break end
      if item:getId() == id then return reqItem:getPocket(), itemId end
    end
  end
  return nil, nil
end

function BagUtils.printContents()
  local bag = pb.getBag()
  for pocketName, pocketId in pairs(pocketType) do
    local pocket = bag:getPocket(pocketId)
    print(string.format("Pocket: %s", pocketName))
    for itemId = 0, pocket:getCapacity() - 1 do
      local item = pocket:getItem(itemId)
      if item:getId() == 0 then break end
      print(string.format("\t%s x%d", pb.getItem(item:getId()):getName(), item:getQuantity()))
    end
  end
end

ITEM = {
  NONE = 0x0,
  MASTERBALL = 0x1,
  ULTRABALL = 0x2,
  GREATBALL = 0x3,
  POKEBALL = 0x4,
  SAFARIBALL = 0x5,
  NETBALL = 0x6,
  DIVEBALL = 0x7,
  NESTBALL = 0x8,
  REPEATBALL = 0x9,
  TIMERBALL = 0xA,
  LUXURYBALL = 0xB,
  PREMIERBALL = 0xC,
  POTION = 0xD,
  ANTIDOTE = 0xE,
  BURNHEAL = 0xF,
  ICEHEAL = 0x10,
  AWAKENING = 0x11,
  PARLYZHEAL = 0x12,
  FULLRESTORE = 0x13,
  MAXPOTION = 0x14,
  HYPERPOTION = 0x15,
  SUPERPOTION = 0x16,
  FULLHEAL = 0x17,
  REVIVE = 0x18,
  MAXREVIVE = 0x19,
  FRESHWATER = 0x1A,
  SODAPOP = 0x1B,
  LEMONADE = 0x1C,
  MOOMOOMILK = 0x1D,
  ENERGYPOWDER = 0x1E,
  ENERGYROOT = 0x1F,
  HEALPOWDER = 0x20,
  REVIVALHERB = 0x21,
  ETHER = 0x22,
  MAXETHER = 0x23,
  ELIXIR = 0x24,
  MAXELIXIR = 0x25,
  LAVACOOKIE = 0x26,
  BLUEFLUTE = 0x27,
  YELLOWFLUTE = 0x28,
  REDFLUTE = 0x29,
  BLACKFLUTE = 0x2A,
  WHITEFLUTE = 0x2B,
  BERRYJUICE = 0x2C,
  SACREDASH = 0x2D,
  SHOALSALT = 0x2E,
  SHOALSHELL = 0x2F,
  REDSHARD = 0x30,
  BLUESHARD = 0x31,
  YELLOWSHARD = 0x32,
  GREENSHARD = 0x33,
  HPUP = 0x3F,
  PROTEIN = 0x40,
  IRON = 0x41,
  CARBOS = 0x42,
  CALCIUM = 0x43,
  RARECANDY = 0x44,
  PPUP = 0x45,
  ZINC = 0x46,
  PPMAX = 0x47,
  GUARDSPEC = 0x49,
  DIREHIT = 0x4A,
  XATTACK = 0x4B,
  XDEFEND = 0x4C,
  XSPEED = 0x4D,
  XACCURACY = 0x4E,
  XSPECIAL = 0x4F,
  POKEDOLL = 0x50,
  FLUFFYTAIL = 0x51,
  SUPERREPEL = 0x53,
  MAXREPEL = 0x54,
  ESCAPEROPE = 0x55,
  REPEL = 0x56,
  SUNSTONE = 0x5D,
  MOONSTONE = 0x5E,
  FIRESTONE = 0x5F,
  THUNDERSTONE = 0x60,
  WATERSTONE = 0x61,
  LEAFSTONE = 0x62,
  TINYMUSHROOM = 0x67,
  BIGMUSHROOM = 0x68,
  PEARL = 0x6A,
  BIGPEARL = 0x6B,
  STARDUST = 0x6C,
  STARPIECE = 0x6D,
  NUGGET = 0x6E,
  HEARTSCALE = 0x6F,
  PURPLEJUICE = 0x71,
  REDJUICE = 0x72,
  GREENJUICE = 0x73,
  PINKJUICE = 0x74,
  YELLOWJUICE = 0x75,
  AWFULJUICE = 0x76,
  SUPERJUICE = 0x77,
  ORANGEMAIL = 0x79,
  HARBORMAIL = 0x7A,
  GLITTERMAIL = 0x7B,
  MECHMAIL = 0x7C,
  WOODMAIL = 0x7D,
  WAVEMAIL = 0x7E,
  BEADMAIL = 0x7F,
  SHADOWMAIL = 0x80,
  TROPICMAIL = 0x81,
  DREAMMAIL = 0x82,
  FABMAIL = 0x83,
  RETROMAIL = 0x84,
  CHERIBERRY = 0x85,
  CHESTOBERRY = 0x86,
  PECHABERRY = 0x87,
  RAWSTBERRY = 0x88,
  ASPEARBERRY = 0x89,
  LEPPABERRY = 0x8A,
  ORANBERRY = 0x8B,
  PERSIMBERRY = 0x8C,
  LUMBERRY = 0x8D,
  SITRUSBERRY = 0x8E,
  FIGYBERRY = 0x8F,
  WIKIBERRY = 0x90,
  MAGOBERRY = 0x91,
  AGUAVBERRY = 0x92,
  IAPAPABERRY = 0x93,
  RAZZBERRY = 0x94,
  BLUKBERRY = 0x95,
  NANABBERRY = 0x96,
  WEPEARBERRY = 0x97,
  PINAPBERRY = 0x98,
  POMEGBERRY = 0x99,
  KELPSYBERRY = 0x9A,
  QUALOTBERRY = 0x9B,
  HONDEWBERRY = 0x9C,
  GREPABERRY = 0x9D,
  TAMATOBERRY = 0x9E,
  CORNNBERRY = 0x9F,
  MAGOSTBERRY = 0xA0,
  RABUTABERRY = 0xA1,
  NOMELBERRY = 0xA2,
  SPELONBERRY = 0xA3,
  PAMTREBERRY = 0xA4,
  WATMELBERRY = 0xA5,
  DURINBERRY = 0xA6,
  BELUEBERRY = 0xA7,
  LIECHIBERRY = 0xA8,
  GANLONBERRY = 0xA9,
  SALACBERRY = 0xAA,
  PETAYABERRY = 0xAB,
  APICOTBERRY = 0xAC,
  LANSATBERRY = 0xAD,
  STARFBERRY = 0xAE,
  ENIGMABERRY = 0xAF,
  BRIGHTPOWDER = 0xB3,
  WHITEHERB = 0xB4,
  MACHOBRACE = 0xB5,
  EXPSHARE = 0xB6,
  QUICKCLAW = 0xB7,
  SOOTHEBELL = 0xB8,
  MENTALHERB = 0xB9,
  CHOICEBAND = 0xBA,
  KINGSROCK = 0xBB,
  SILVERPOWDER = 0xBC,
  AMULETCOIN = 0xBD,
  CLEANSETAG = 0xBE,
  SOULDEW = 0xBF,
  DEEPSEATOOTH = 0xC0,
  DEEPSEASCALE = 0xC1,
  SMOKEBALL = 0xC2,
  EVERSTONE = 0xC3,
  FOCUSBAND = 0xC4,
  LUCKYEGG = 0xC5,
  SCOPELENS = 0xC6,
  METALCOAT = 0xC7,
  LEFTOVERS = 0xC8,
  DRAGONSCALE = 0xC9,
  LIGHTBALL = 0xCA,
  SOFTSAND = 0xCB,
  HARDSTONE = 0xCC,
  MIRACLESEED = 0xCD,
  BLACKGLASSES = 0xCE,
  BLACKBELT = 0xCF,
  MAGNET = 0xD0,
  MYSTICWATER = 0xD1,
  SHARPBEAK = 0xD2,
  POISONBARB = 0xD3,
  NEVERMELTICE = 0xD4,
  SPELLTAG = 0xD5,
  TWISTEDSPOON = 0xD6,
  CHARCOAL = 0xD7,
  DRAGONFANG = 0xD8,
  SILKSCARF = 0xD9,
  UPGRADE = 0xDA,
  SHELLBELL = 0xDB,
  SEAINCENSE = 0xDC,
  LAXINCENSE = 0xDD,
  LUCKYPUNCH = 0xDE,
  METALPOWDER = 0xDF,
  THICKCLUB = 0xE0,
  STICK = 0xE1,
  MYSTERYTM01 = 0xE2,
  MYSTERYTM02 = 0xE3,
  MYSTERYTM03 = 0xE4,
  MYSTERYTM04 = 0xE5,
  MYSTERYTM05 = 0xE6,
  MYSTERYTM06 = 0xE7,
  MYSTERYTM07 = 0xE8,
  MYSTERYTM08 = 0xE9,
  MYSTERYTM09 = 0xEA,
  MYSTERYTM10 = 0xEB,
  MYSTERYTM11 = 0xEC,
  MYSTERYTM12 = 0xED,
  MYSTERYTM13 = 0xEE,
  REDSCARF = 0xFE,
  BLUESCARF = 0xFF,
  PINKSCARF = 0x100,
  GREENSCARF = 0x101,
  YELLOWSCARF = 0x102,
  MACHBIKE = 0x103,
  COINCASE = 0x104,
  ITEMFINDER = 0x105,
  OLDROD = 0x106,
  GOODROD = 0x107,
  SUPERROD = 0x108,
  SSTICKET = 0x109,
  CONTESTPASS = 0x10A,
  WAILMERPAIL = 0x10C,
  DEVONGOODS = 0x10D,
  SOOTSACK = 0x10E,
  BASEMENTKEY = 0x10F,
  ACROBIKE = 0x110,
  POKEBLOCKCASE = 0x111,
  LETTER = 0x112,
  EONTICKET = 0x113,
  REDORB = 0x114,
  BLUEORB = 0x115,
  SCANNER = 0x116,
  GOGOGGLES = 0x117,
  METEORITE = 0x118,
  RM1KEY = 0x119,
  RM2KEY = 0x11A,
  RM4KEY = 0x11B,
  RM6KEY = 0x11C,
  STORAGEKEY = 0x11D,
  ROOTFOSSIL = 0x11E,
  CLAWFOSSIL = 0x11F,
  DEVONSCOPE = 0x120,
  TM01 = 0x121,
  TM02 = 0x122,
  TM03 = 0x123,
  TM04 = 0x124,
  TM05 = 0x125,
  TM06 = 0x126,
  TM07 = 0x127,
  TM08 = 0x128,
  TM09 = 0x129,
  TM10 = 0x12A,
  TM11 = 0x12B,
  TM12 = 0x12C,
  TM13 = 0x12D,
  TM14 = 0x12E,
  TM15 = 0x12F,
  TM16 = 0x130,
  TM17 = 0x131,
  TM18 = 0x132,
  TM19 = 0x133,
  TM20 = 0x134,
  TM21 = 0x135,
  TM22 = 0x136,
  TM23 = 0x137,
  TM24 = 0x138,
  TM25 = 0x139,
  TM26 = 0x13A,
  TM27 = 0x13B,
  TM28 = 0x13C,
  TM29 = 0x13D,
  TM30 = 0x13E,
  TM31 = 0x13F,
  TM32 = 0x140,
  TM33 = 0x141,
  TM34 = 0x142,
  TM35 = 0x143,
  TM36 = 0x144,
  TM37 = 0x145,
  TM38 = 0x146,
  TM39 = 0x147,
  TM40 = 0x148,
  TM41 = 0x149,
  TM42 = 0x14A,
  TM43 = 0x14B,
  TM44 = 0x14C,
  TM45 = 0x14D,
  TM46 = 0x14E,
  TM47 = 0x14F,
  TM48 = 0x150,
  TM49 = 0x151,
  TM50 = 0x152,
  HM01 = 0x153,
  HM02 = 0x154,
  HM03 = 0x155,
  HM04 = 0x156,
  HM05 = 0x157,
  HM06 = 0x158,
  HM07 = 0x159,
  HM08 = 0x15A,
  TM51 = 0x15B,
  OAKSPARCEL = 0x15D,
  POKEFLUTE = 0x15E,
  SECRETKEY = 0x15F,
  BIKEVOUCHER = 0x160,
  GOLDTEETH = 0x161,
  OLDAMBER = 0x162,
  CARDKEY = 0x163,
  LIFTKEY = 0x164,
  HELIXFOSSIL = 0x165,
  DOMEFOSSIL = 0x166,
  SILPHSCOPE = 0x167,
  BICYCLE = 0x168,
  TOWNMAP = 0x169,
  VSSEEKER = 0x16A,
  FAMECHECKER = 0x16B,
  TMCASE = 0x16C,
  BERRYPOUCH = 0x16D,
  TEACHYTV = 0x16E,
  TRIPASS = 0x16F,
  RAINBOWPASS = 0x170,
  TEA = 0x171,
  MYSTICTICKET = 0x172,
  AURORATICKET = 0x173,
  POWDERJAR = 0x174,
  RUBY = 0x175,
  SAPPHIRE = 0x176,
  MAGMAEMBLEM = 0x177,
  OLDSEAMAP = 0x178,
}
